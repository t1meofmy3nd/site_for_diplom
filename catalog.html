<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Каталог | МедТех</title>
  <link rel="stylesheet" href="styles.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>

<header>
  <a href="index.html" class="logo">
    <img src="images/logo.png" alt="МедТех" />
  </a>
  <button class="menu-toggle" aria-label="Меню"><i class="fa-solid fa-bars"></i></button>
  <nav>
    <a href="index.html">Главная</a>
    <a href="catalog.html" class="active">Каталог</a>
    <a href="services.html">Услуги</a>
    <a href="about.html">О нас</a>
    <a href="cart.html" class="cart-link"><i class="fa-solid fa-cart-shopping"></i><span class="cart-count">0</span></a>
    <a href="profile.php" class="account-link" style="display:none;"><i class="fa-solid fa-user"></i> Личный кабинет</a>
    <a href="login.php" class="login-link"><i class="fa-solid fa-right-to-bracket"></i> Войти</a>
    <a href="register.php" class="register-link"><i class="fa-solid fa-user-plus"></i> Регистрация</a>
    <a href="logout.php" class="logout-link" style="display:none;"><i class="fa-solid fa-right-from-bracket"></i> Выход</a>
  </nav>
</header>

<div class="catalog-container">
  <aside class="filter-panel">
    <div class="filter-group">
      <h4>Категория</h4>
      <ul>
        <li><label><input type="checkbox" value="УЗИ" class="filter-category"> УЗИ</label></li>
        <li><label><input type="checkbox" value="Рентген" class="filter-category"> Рентген</label></li>
        <li><label><input type="checkbox" value="Дефибрилляторы" class="filter-category"> Дефибрилляторы</label></li>
        <li><label><input type="checkbox" value="ЭКГ" class="filter-category"> ЭКГ</label></li>
        <li><label><input type="checkbox" value="Мониторы" class="filter-category"> Мониторы</label></li>
      </ul>
    </div>
    <div class="filter-group">
      <h4>Цена</h4>
      <div class="price-range">
        <input type="number" id="minPrice" placeholder="от">
        <input type="number" id="maxPrice" placeholder="до">
      </div>
    </div>
    <div class="filter-group">
      <h4>Наличие</h4>
      <label><input type="checkbox" id="stockOnly"> В наличии</label>
    </div>
    <div class="filter-group">
      <h4>Бренд</h4>
      <ul>
        <li><label><input type="checkbox" value="Brand 1" class="filter-brand"> Brand 1</label></li>
        <li><label><input type="checkbox" value="Brand 2" class="filter-brand"> Brand 2</label></li>
        <li><label><input type="checkbox" value="Brand 3" class="filter-brand"> Brand 3</label></li>
        <li><label><input type="checkbox" value="Brand 4" class="filter-brand"> Brand 4</label></li>
        <li><label><input type="checkbox" value="Brand 5" class="filter-brand"> Brand 5</label></li>
        <li><label><input type="checkbox" value="Brand 6" class="filter-brand"> Brand 6</label></li>
      </ul>
    </div>
    <div class="filter-group">
      <h4>Популярность</h4>
      <label><input type="checkbox" id="sortPopular"> Сначала популярные</label>
    </div>
    <button id="resetFilters" class="reset-btn"><i class="fa-solid fa-rotate-left"></i> Сбросить</button>
  </aside>

  <div class="catalog-content">
    <button id="filtersBtn" class="filters-btn"><i class="fa-solid fa-filter"></i> Фильтры</button>
    <div class="active-filters">
      <input type="text" id="searchInput" placeholder="Поиск по названию" style="flex:1;min-width:150px;">
      <span id="resultCount"></span>
      <div id="filterTags" class="filters-tags"></div>
    </div>
    <section id="product-list" class="products-grid"></section>
  </div>
</div>

<footer>
  &copy; 2025 МедТех. Все права защищены.
</footer>

<script src="products.js"></script>
<script>
function generateStars(rating) {
  const full = Math.floor(rating);
  const half = rating % 1 >= 0.5;
  let html = '<i class="fa-solid fa-star"></i>'.repeat(full);
  if (half) html += '<i class="fa-solid fa-star-half-stroke"></i>';
  html += '<i class="fa-regular fa-star"></i>'.repeat(5 - full - (half ? 1 : 0));
  return html;
}

document.addEventListener('DOMContentLoaded', () => {
  const searchInput = document.getElementById('searchInput');
  const categoryCheckboxes = document.querySelectorAll('.filter-category');
  const brandCheckboxes = document.querySelectorAll('.filter-brand');
  const minPrice = document.getElementById('minPrice');
  const maxPrice = document.getElementById('maxPrice');
  const stockOnly = document.getElementById('stockOnly');
  const sortPopular = document.getElementById('sortPopular');
  const resetBtn = document.getElementById('resetFilters');
  const resultCount = document.getElementById('resultCount');
  const filterTags = document.getElementById('filterTags');
  const filtersBtn = document.getElementById('filtersBtn');
  const filterPanel = document.querySelector('.filter-panel');
  });
  
  if (filtersBtn) {
    filtersBtn.addEventListener('click', () => filterPanel.classList.toggle('open'));
  }

    function getChecked(list) {
    return Array.from(list).filter(i => i.checked).map(i => i.value);
  }

    function updateTags(tags) {
    filterTags.innerHTML = '';
    tags.forEach(t => {
      const span = document.createElement('span');
      span.className = 'tag';
      span.textContent = t;
      filterTags.appendChild(span);
    });
  }

  function filterAndRender() {
    let filtered = [...products];
    const search = searchInput.value.trim().toLowerCase();
    const categories = getChecked(categoryCheckboxes);
    const brands = getChecked(brandCheckboxes);
    const min = parseInt(minPrice.value) || 0;
    const max = parseInt(maxPrice.value) || Infinity;

    if (search) filtered = filtered.filter(p => p.name.toLowerCase().includes(search));
    if (categories.length) filtered = filtered.filter(p => categories.includes(p.category));
    if (brands.length) filtered = filtered.filter(p => brands.includes(p.brand));
    filtered = filtered.filter(p => p.price >= min && p.price <= max);
    if (stockOnly.checked) filtered = filtered.filter(p => p.stock);
    if (sortPopular.checked) filtered.sort((a,b) => b.rating - a.rating);

    resultCount.textContent = 'Найдено: ' + filtered.length;
    updateTags([...categories, ...brands]);

    const container = document.getElementById('product-list');
    container.innerHTML = '';
    filtered.forEach(product => {
      const card = document.createElement('div');
      card.className = 'product-card';
      card.innerHTML = `
        <img src="${product.img}" alt="${product.name}">
        <h3>${product.name}</h3>
        <p class="desc">${product.description}</p>
        <div class="rating">${generateStars(product.rating)}</div>
        <p class="price">${product.price.toLocaleString()} ₽</p>
        <p class="stock">${product.stock ? 'В наличии' : 'Нет в наличии'} • ${product.delivery}</p>
        <button onclick="addToCart(${product.id})" class="add-btn"><i class="fa-solid fa-cart-plus"></i> В корзину</button>
      `;
      container.appendChild(card);
    });
  }

  [...categoryCheckboxes, ...brandCheckboxes, searchInput, minPrice, maxPrice, stockOnly, sortPopular].forEach(el => {
    el.addEventListener('input', filterAndRender);

  
    filterAndRender();
  });
  resetBtn.addEventListener('click', () => {
    searchInput.value = '';
    categoryCheckboxes.forEach(c => c.checked = false);
    brandCheckboxes.forEach(c => c.checked = false);
    minPrice.value = '';
    maxPrice.value = '';
    stockOnly.checked = false;
    sortPopular.checked = false;
  filterAndRender();
});
</script>
<script src="header.js"></script>
<script src="session.js"></script>

</body>
</html>